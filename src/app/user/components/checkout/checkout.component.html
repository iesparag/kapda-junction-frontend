<div class="checkout">
  <div class="container">
    <h1>Checkout</h1>
    
    <div class="checkout-content" *ngIf="cartItems$ | async as cartItems">
      <div class="checkout-form">
        <div class="card">
          <h2>Shipping Address</h2>
          <form>
            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <input type="text" class="form-control" [(ngModel)]="shippingAddress.name" 
                     name="name" required>
            </div>
            <div class="form-group">
              <label class="form-label">Address *</label>
              <textarea class="form-control" [(ngModel)]="shippingAddress.address" 
                        name="address" rows="3" required></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">State *</label>
                <select class="form-control" [(ngModel)]="shippingAddress.state" 
                        name="state" (change)="onStateChange()" required>
                  <option value="">Select State</option>
                  <option *ngFor="let state of states" [value]="state">{{ state }}</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">City *</label>
                <select class="form-control" [(ngModel)]="shippingAddress.city" 
                        name="city" (change)="onCityChange()" 
                        [disabled]="!shippingAddress.state" required>
                  <option value="">Select City</option>
                  <option *ngFor="let city of cities" [value]="city.name">{{ city.name }}</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Pincode *</label>
                <select class="form-control" [(ngModel)]="shippingAddress.zipCode" 
                        name="zipCode" (change)="onZipCodeChange()" 
                        [disabled]="!shippingAddress.city" required>
                  <option value="">Select Pincode</option>
                  <option *ngFor="let pincode of pincodes" [value]="pincode">{{ pincode }}</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Phone *</label>
                <input type="tel" class="form-control" [(ngModel)]="shippingAddress.phone" 
                       name="phone" required>
              </div>
            </div>
          </form>
        </div>

        <div class="card">
          <h2>Order Items</h2>
          <div class="order-items">
            <div class="order-item" *ngFor="let item of cartItems">
              <div class="item-image">
                <img [src]="item.product.images[0] || 'https://via.placeholder.com/60x60'" 
                     [alt]="item.product.name">
              </div>
              <div class="item-details">
                <h4>{{ item.product.name }}</h4>
                <p>Quantity: {{ item.quantity }}</p>
              </div>
              <div class="item-price">
                â‚¹{{ ((item.product.discount ? item.product.price * (1 - item.product.discount / 100) : item.product.price) * item.quantity).toFixed(0) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="order-summary">
        <div class="card">
          <h2>Order Summary</h2>
          <div class="summary-row">
            <span>Subtotal:</span>
            <span>â‚¹{{ getTotal(cartItems).toFixed(0) }}</span>
          </div>
          <div class="summary-row">
            <span>Packaging Charge:</span>
            <span>â‚¹{{ packagingCharge.toFixed(0) }}</span>
          </div>
          <div class="summary-row">
            <span>Delivery Charge:</span>
            <span *ngIf="isFreeDelivery" class="free-delivery">Free</span>
            <span *ngIf="!isFreeDelivery">â‚¹{{ deliveryCharge.toFixed(0) }}</span>
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span>â‚¹{{ getFinalTotal(cartItems).toFixed(0) }}</span>
          </div>
          <div *ngIf="isFreeDelivery" class="free-delivery-badge">
            ðŸŽ‰ Free Delivery Applied!
          </div>
          <button class="btn btn-primary btn-block" (click)="placeOrder(cartItems)">
            Place Order
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

