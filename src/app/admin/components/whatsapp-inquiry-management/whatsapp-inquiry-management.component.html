<div class="inquiry-management">
  <div class="container">
    <h1>WhatsApp Inquiries</h1>

    <!-- Stats Cards -->
    <div class="stats-grid" *ngIf="stats$ | async as stats">
      <div class="stat-card">
        <h3>Total</h3>
        <p class="stat-value">{{ stats.total }}</p>
      </div>
      <div class="stat-card status-pending">
        <h3>Pending</h3>
        <p class="stat-value">{{ stats.pending }}</p>
      </div>
      <div class="stat-card status-responded">
        <h3>Responded</h3>
        <p class="stat-value">{{ stats.responded }}</p>
      </div>
      <div class="stat-card status-closed">
        <h3>Closed</h3>
        <p class="stat-value">{{ stats.closed }}</p>
      </div>
    </div>

    <!-- Filter -->
    <div class="filter-section">
      <label for="statusFilter">Filter by Status:</label>
      <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="onStatusFilterChange()">
        <option value="all">All</option>
        <option value="pending">Pending</option>
        <option value="responded">Responded</option>
        <option value="closed">Closed</option>
      </select>
    </div>

    <!-- Inquiries List -->
    <div class="inquiries-list" *ngIf="inquiries$ | async as inquiries">
      <div *ngIf="inquiries.length === 0" class="empty-state">
        <p>No inquiries found.</p>
      </div>

      <div class="inquiry-card" *ngFor="let inquiry of inquiries">
        <div class="inquiry-header">
          <div class="inquiry-user">
            <h3>{{ inquiry.userName }}</h3>
            <p class="inquiry-meta">
              <span *ngIf="inquiry.userEmail">{{ inquiry.userEmail }}</span>
              <span *ngIf="inquiry.userPhone"> | {{ inquiry.userPhone }}</span>
            </p>
          </div>
          <div class="inquiry-status">
            <span class="status-badge" [ngClass]="getStatusClass(inquiry.status || 'pending')">
              {{ inquiry.status || 'pending' }}
            </span>
          </div>
        </div>

        <div class="inquiry-product">
          <img [src]="inquiry.productImage || 'https://via.placeholder.com/80'" [alt]="inquiry.productName">
          <div class="product-details">
            <h4>{{ inquiry.productName }}</h4>
            <p class="product-price">â‚¹{{ inquiry.productPrice }}</p>
            <a [href]="inquiry.productLink" target="_blank" class="product-link">
              View Product â†’
            </a>
          </div>
        </div>

        <div class="inquiry-message">
          <p><strong>Message:</strong></p>
          <p>{{ inquiry.message }}</p>
        </div>

        <div class="inquiry-footer">
          <div class="inquiry-date">
            <small>Submitted: {{ formatDate(inquiry.createdAt) }}</small>
          </div>
          <div class="inquiry-actions">
            <button class="btn btn-sm btn-info" (click)="viewInquiry(inquiry)">View Details</button>
            <button 
              class="btn btn-sm btn-whatsapp" 
              *ngIf="inquiry.whatsappUrl"
              (click)="openWhatsApp(inquiry.whatsappUrl)"
              title="Open WhatsApp Web Link">
              ðŸ’¬ Open WhatsApp
            </button>
            <button 
              class="btn btn-sm btn-primary" 
              (click)="resendMessage(inquiry)"
              title="Resend WhatsApp Message via API">
              ðŸ“¤ Resend Message
            </button>
            <button 
              class="btn btn-sm btn-success" 
              *ngIf="inquiry.status === 'pending'"
              (click)="updateStatus(inquiry, 'responded')">
              Mark Responded
            </button>
            <button 
              class="btn btn-sm btn-warning" 
              *ngIf="inquiry.status !== 'closed'"
              (click)="updateStatus(inquiry, 'closed')">
              Close
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteInquiry(inquiry)">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Inquiry Detail Modal -->
  <div class="modal-overlay" *ngIf="selectedInquiry" (click)="closeInquiryDetail()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Inquiry Details</h2>
        <button class="close-btn" (click)="closeInquiryDetail()">Ã—</button>
      </div>
      <div class="modal-body" *ngIf="selectedInquiry">
        <div class="detail-section">
          <h3>User Information</h3>
          <p><strong>Name:</strong> {{ selectedInquiry.userName }}</p>
          <p *ngIf="selectedInquiry.userEmail"><strong>Email:</strong> {{ selectedInquiry.userEmail }}</p>
          <p *ngIf="selectedInquiry.userPhone"><strong>Phone:</strong> {{ selectedInquiry.userPhone }}</p>
        </div>
        <div class="detail-section">
          <h3>Product Information</h3>
          <div class="product-preview">
            <img [src]="selectedInquiry.productImage || 'https://via.placeholder.com/150'" [alt]="selectedInquiry.productName">
            <div>
              <p><strong>Name:</strong> {{ selectedInquiry.productName }}</p>
              <p><strong>Price:</strong> â‚¹{{ selectedInquiry.productPrice }}</p>
              <a [href]="selectedInquiry.productLink" target="_blank" class="product-link">View Product â†’</a>
            </div>
          </div>
        </div>
        <div class="detail-section">
          <h3>Message</h3>
          <p>{{ selectedInquiry.message }}</p>
        </div>
        <div class="detail-section">
          <h3>Status</h3>
          <span class="status-badge" [ngClass]="getStatusClass(selectedInquiry.status || 'pending')">
            {{ selectedInquiry.status || 'pending' }}
          </span>
        </div>
        <div class="detail-section" *ngIf="selectedInquiry.whatsappUrl">
          <h3>WhatsApp Message</h3>
          <div class="whatsapp-actions">
            <button class="btn btn-whatsapp" (click)="openWhatsApp(selectedInquiry.whatsappUrl)">
              ðŸ’¬ Open WhatsApp Web
            </button>
            <button class="btn btn-primary" (click)="resendMessage(selectedInquiry)">
              ðŸ“¤ Resend via API
            </button>
          </div>
          <p class="whatsapp-info">
            <small>Use "Open WhatsApp Web" to manually send, or "Resend via API" to send automatically</small>
          </p>
        </div>
        <div class="detail-section">
          <p><strong>Submitted:</strong> {{ formatDate(selectedInquiry.createdAt) }}</p>
          <p *ngIf="selectedInquiry.updatedAt"><strong>Last Updated:</strong> {{ formatDate(selectedInquiry.updatedAt) }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

